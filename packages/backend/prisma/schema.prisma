generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["interactiveTransactions", "fullTextSearch", "orderByNulls"]
}

datasource db {
  provider = "postgresql"
  url      = env("DB_URL")
}

enum Role {
  USER
  MODERATOR
  ADMIN
}

model User {
  id        String      @id @default(uuid()) @db.Uuid
  username  String      @unique @db.VarChar(128)
  email     String      @unique @db.VarChar(256)
  password  String      @db.VarChar(256)
  role      Role        @default(USER)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @default(now())
  auth      Auth[]
  bookmarks Bookmarks[]
  viewed    Viewed[]
}

model Auth {
  id           String   @id @default(uuid()) @db.Uuid
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId       String   @db.Uuid
  refreshToken String   @db.VarChar(2048)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now())
}

model Movie {
  id          String      @id @default(uuid()) @db.Uuid
  title       String      @db.VarChar(512)
  description String      @db.VarChar(4096)
  tagline     String?      @db.VarChar(512)
  releaseDate DateTime?
  runtime     Int?
  budget      BigInt?
  revenue     BigInt?
  poster      String?      @db.VarChar(1024)
  trailer     String?      @db.VarChar(1024)
  averageRate Decimal?     @db.Decimal(3, 2)
  countVotes  BigInt?
  megogoLink    String?
  genres      Genre[]
  countries   Country[]
  directors     Director[]
  actors      Actor[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @default(now())
  Bookmarks   Bookmarks[]
  Viewed      Viewed[]
}

model Actor {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @db.VarChar(256)
  surname   String   @db.VarChar(256)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  movies    Movie[]
}

model Director {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @db.VarChar(256)
  surname   String   @db.VarChar(256)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  movies    Movie[]
}

model Genre {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @db.VarChar(128)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  movies    Movie[]
}

model Country {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @db.VarChar(128)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  movies    Movie[]
}

model Bookmarks {
  id        String   @id @default(uuid()) @db.Uuid
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  movieId   String   @db.Uuid
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId    String   @db.Uuid
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Viewed {
  id        String   @id @default(uuid()) @db.Uuid
  movie     Movie    @relation(fields: [movieId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  movieId   String   @db.Uuid
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  userId    String   @db.Uuid
  rate      Decimal?  @db.Decimal(3, 2)
  description String? @db.VarChar(4096)
  private   Boolean
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}
